<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RECOMENDACIONES BARILOCHE</title>
  <style>
    :root{
      --bg:#f5f5f2;
      --card:#fff;
      --accent:#c8b99c;
      --border:#ddd;
      --text:#222;
    }
    body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);}
    .header{background:var(--bg);padding:20px;text-align:center;border-bottom:1px solid var(--border);}
    .header h1{margin:0;font-size:22px;font-weight:600;}
    .container{padding:16px;max-width:1000px;margin:auto;}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);margin-bottom:20px;}
    .menu a{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;margin:8px 0;text-decoration:none;color:var(--text);background:var(--bg);border-radius:8px;font-size:16px;font-weight:500;transition:background .2s;}
    .menu a:hover{background:#e9e9e4;}
    h3.segment{background:var(--accent);color:#fff;padding:6px 12px;border-radius:6px;font-size:15px;font-weight:600;display:inline-block;margin:18px 0 10px 0;}
    table{width:100%;border-collapse:collapse;margin-bottom:18px;border:1px solid var(--border);border-radius:10px;overflow:hidden;table-layout:fixed}
    th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top;font-size:15px;line-height:1.45;}
    th{background:#e2e0da;text-align:left;font-weight:600;}
    tr:last-child td{border-bottom:none;}
    .search{margin:12px 0;}
    .search input{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px}
    .back{display:inline-block;margin-bottom:12px;text-decoration:none;color:#444;font-size:14px}
    @media(max-width:768px){
      table,thead,tbody,tr,th,td{display:block}
      thead{display:none}
      tr{margin-bottom:14px;background:#fff;border:1px solid var(--border);border-radius:8px;padding:8px}
      td{border:none;padding:6px 8px;position:relative;font-size:14px}
      td::before{content:attr(data-label);font-weight:600;display:block;margin-bottom:4px;color:#555;font-size:12px}
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>RECOMENDACIONES BARILOCHE</h1>
  </div>
  <div class="container">
    <div id="app" class="card"></div>
  </div>
  <script>
    const SHEET_ID = "1Kr3AIdE6fl8rVtv9lWRprLMOSYtxhcSUDkeFES9AyIw";
    const urls = {
      "GASTRONOMIA": `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=1720586403`,
      "PLAYAS": `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=1968374221`,
      "EXCURSIONES": `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=222330063`
    };
    const segments = {
      "GASTRONOMIA": ["ALMUERZO - CENA","DESAYUNO - MERIENDA","VILLA LA ANGOSTURA"],
      "PLAYAS": ["BARILOCHE","VILLA LA ANGOSTURA"],
      "EXCURSIONES": ["BARILOCHE"]
    };
    const colWidths = {
      "GASTRONOMIA": ["22%","15%","8%","13%","42%"], // más ancho IG, menos PRECIOS
      "PLAYAS": ["28%","22%","50%"],
      "EXCURSIONES": ["28%","22%","50%"]
    };

    const app = document.getElementById("app");
    function showMenu(){
      app.innerHTML = `
        <div class="menu">
          <a href="#GASTRONOMIA"><span>GASTRONOMIA</span><span>›</span></a>
          <a href="#PLAYAS"><span>PLAYAS</span><span>›</span></a>
          <a href="#EXCURSIONES"><span>EXCURSIONES</span><span>›</span></a>
        </div>
      `;
    }
    async function showSection(name){
      app.innerHTML = `<a href="#" class="back">← Volver al menú</a><h2>${name}</h2>
        <div class="search"><input id="searchInput" type="search" placeholder="Buscar en todas las tablas..."></div>
        <div id="tables">Cargando...</div>`;
      document.querySelector(".back").onclick = e => { e.preventDefault(); showMenu(); }
      try{
        const resp = await fetch(urls[name]);
        const text = await resp.text();
        const rows = text.trim().split("\n").map(r=>r.split(","));
        renderTables(name,rows);
        document.getElementById("searchInput").addEventListener("input",filterTable);
      }catch(err){
        document.getElementById("tables").innerHTML = `<p style="color:red">Error al cargar datos</p>`;
      }
    }
    function renderTables(sheet,rows){
      const segTitles = segments[sheet];
      const widths = colWidths[sheet]||[];
      const headers = rows[0];
      let html = "";
      let current=[], currentTitle=null;
      for(let i=1;i<rows.length;i++){
        const row=rows[i].map(c=>c.trim());
        if(row.filter(c=>c).length===1 && segTitles.includes(row[0])){
          if(current.length){html+=makeTable(headers,current,currentTitle,widths);}
          current=[]; currentTitle=row[0]; continue;
        }
        current.push(row);
      }
      if(current.length){html+=makeTable(headers,current,currentTitle||segTitles[0],widths);}
      document.getElementById("tables").innerHTML=html;
    }
    function makeTable(headers,rows,title,widths){
      let colgroup="";
      if(widths.length===headers.length){
        colgroup="<colgroup>"+widths.map(w=>`<col style="width:${w}">`).join("")+"</colgroup>";
      }
      let thead="<thead><tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr></thead>";
      let tbody="<tbody>";
      rows.forEach(r=>{
        tbody+="<tr>";
        r.forEach((c,j)=>{tbody+=`<td data-label="${headers[j]}">${c}</td>`});
        tbody+="</tr>";
      });
      tbody+="</tbody>";
      return `<h3 class="segment">${title}</h3><table>${colgroup}${thead}${tbody}</table>`;
    }
    function filterTable(){
      const val=document.getElementById("searchInput").value.toLowerCase();
      document.querySelectorAll("tbody tr").forEach(tr=>{
        tr.style.display=tr.innerText.toLowerCase().includes(val)?"":"none";
      });
    }
    window.addEventListener("hashchange",()=>{
      const p=location.hash.replace("#","");
      if(!p) showMenu(); else showSection(p);
    });
    if(location.hash) showSection(location.hash.replace("#","")); else showMenu();
  </script>
</body>
</html>
