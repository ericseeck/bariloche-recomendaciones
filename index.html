<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RECOMENDACIONES BARILOCHE</title>
  <style>
    :root{
      --bg:#f5f5f2; --card:#ffffff; --accent:#c8b99c;
      --border:#ddd; --text:#222;
    }
    body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);}
    .header{background:var(--bg);padding:20px;text-align:center;border-bottom:1px solid var(--border);}
    .header .title{margin:0;font-size:22px;font-weight:600;}
    .container{padding:16px;max-width:900px;margin:auto;}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);margin-bottom:20px;}

    .menu a{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;margin:8px 0;text-decoration:none;color:var(--text);background:var(--bg);border-radius:8px;font-size:16px;font-weight:500;transition:background .2s;}
    .menu a:hover{background:#e9e9e4;}
    .menu .label{flex:1}

    .back{display:inline-block;margin-bottom:12px;text-decoration:none;color:#444;font-size:14px;cursor:pointer}

    h2{margin:8px 0 12px 0}
    h3{background:var(--accent);color:#fff;padding:6px 12px;border-radius:6px;font-size:15px;font-weight:600;display:inline-block}

    table{width:100%;border-collapse:collapse;margin-bottom:18px;border:1px solid var(--border);border-radius:10px;overflow:hidden;table-layout:fixed}
    th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top;font-size:15px;line-height:1.45;}
    th{background:#f0efeb;text-align:left;font-weight:600}
    tr:last-child td{border-bottom:none}

    .search{margin:12px 0;}
    .search input{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px}

    @media(max-width:768px){
      table,thead,tbody,tr,th,td{display:block}
      thead{display:none}
      tr{margin-bottom:14px;background:#fff;border:1px solid var(--border);border-radius:8px;padding:8px}
      td{border:none;padding:6px 8px;position:relative;font-size:14px}
      td::before{content:attr(data-label);font-weight:600;display:block;margin-bottom:4px;color:#555;font-size:12px}
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 class="title">RECOMENDACIONES BARILOCHE</h1>
  </div>

  <div class="container">
    <!-- Menú -->
    <div id="menu" class="card">
      <div class="menu">
        <a href="#GASTRONOMIA"><span class="label">GASTRONOMIA</span><span>›</span></a>
        <a href="#PLAYAS"><span class="label">PLAYAS</span><span>›</span></a>
        <a href="#EXCURSIONES"><span class="label">EXCURSIONES</span><span>›</span></a>
      </div>
      <div class="note">Hacé clic en cada sección para ver su tabla.</div>
    </div>

    <!-- Contenido de sección -->
    <div id="content"></div>
  </div>

  <div class="footer" style="text-align:center;font-size:12px;color:#666;padding:20px;">
    Sitio generado con Google Sheets + GitHub Pages
  </div>

  <script>
    // ===== CONFIG =====
    const SHEET_ID = "1Kr3AIdE6fl8rVtv9lWRprLMOSYtxhcSUDkeFES9AyIw";
    const SHEETS = {
      "GASTRONOMIA": "1720586403",
      "PLAYAS": "1968374221",
      "EXCURSIONES": "222330063"
    };

    // Construye la URL CSV estable (requiere que el Sheet sea público o "con enlace - lector")
    function sheetCsvUrl(gid){
      return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${gid}`;
    }

    // CSV parser que respeta comillas y comas dentro de campos
    function parseCSV(text){
      const rows = [];
      let row = [], cell = "", quote = false;
      for (let i=0; i<text.length; i++){
        const ch = text[i], nxt = text[i+1];
        if (quote){
          if (ch === '"' && nxt === '"'){ cell += '"'; i++; }
          else if (ch === '"'){ quote = false; }
          else { cell += ch; }
        } else {
          if (ch === '"'){ quote = true; }
          else if (ch === ','){ row.push(cell); cell = ""; }
          else if (ch === '\n'){ row.push(cell); rows.push(row); row = []; cell = ""; }
          else if (ch === '\r'){ /* ignorar */ }
          else { cell += ch; }
        }
      }
      // último campo
      row.push(cell);
      // si la última línea venía sin \n, empujarla
      if (row.length && (rows.length === 0 || rows[rows.length-1] !== row)) rows.push(row);
      // eliminar filas vacías
      return rows.filter(r => r.some(c => String(c).trim() !== ""));
    }

    // Convierte CSV a tabla HTML responsive
    function csvToTable(csv, title){
      const rows = parseCSV(csv);
      if (!rows.length) return "<p>Sin datos</p>";
      const header = rows[0];
      let thead = "<thead><tr>" + header.map(h => `<th>${escapeHtml(h)}</th>`).join("") + "</tr></thead>";
      let tbody = "<tbody>";
      for (let i=1; i<rows.length; i++){
        const r = rows[i];
        tbody += "<tr>";
        for (let j=0; j<header.length; j++){
          const label = escapeHtml(header[j] || "");
          const val = escapeHtml(r[j] || "");
          // Autolink básico (http/https)
          const html = /^https?:\/\//i.test(r[j] || "") ? `<a href="${r[j]}" target="_blank" rel="noopener">${val}</a>` : val;
          tbody += `<td data-label="${label}">${html}</td>`;
        }
        tbody += "</tr>";
      }
      tbody += "</tbody>";
      return `
        <a class="back" onclick="showMenu()">← Volver al menú</a>
        <h2>${escapeHtml(title)}</h2>
        <div class="search"><input id="searchInput" type="search" placeholder="Buscar en todas las tablas..." oninput="filterTable()"></div>
        <table>${thead}${tbody}</table>`;
    }

    function escapeHtml(s){
      return String(s==null?"":s)
        .replace(/&/g,"&amp;").replace(/</g,"&lt;")
        .replace(/>/g,"&gt;").replace(/"/g,"&quot;")
        .replace(/'/g,"&#39;");
    }

    // Carga una hoja por nombre (usa CSV)
    async function loadSheet(sheetName){
      const gid = SHEETS[sheetName];
      if (!gid) return `<p style="color:#b00020">No existe la sección: ${escapeHtml(sheetName)}</p>`;
      const url = sheetCsvUrl(gid);
      try{
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        return csvToTable(text, sheetName);
      }catch(err){
        return `<p style="color:#b00020">Failed to fetch. Verificá que la planilla esté disponible para "Cualquiera con el enlace – Lector" o "Publicada en la web".</p>`;
      }
    }

    // Buscador
    function filterTable(){
      const input = document.getElementById('searchInput');
      if (!input) return;
      const f = input.value.toLowerCase();
      document.querySelectorAll('tbody tr').forEach(tr=>{
        tr.style.display = tr.innerText.toLowerCase().includes(f) ? "" : "none";
      });
    }

    // UI: menú / sección
    function showMenu(){
      document.getElementById("menu").style.display = "block";
      document.getElementById("content").innerHTML = "";
      // limpiar hash sin recargar
      history.replaceState(null, "", location.pathname + location.search);
    }

    async function showSection(name){
      document.getElementById("menu").style.display = "none";
      document.getElementById("content").innerHTML = "Cargando…";
      document.getElementById("content").innerHTML = await loadSheet(name);
    }

    // Navegación por hash
    window.addEventListener("hashchange", async ()=>{
      const hash = location.hash.replace("#","");
      if (SHEETS[hash]) showSection(hash);
      else showMenu();
    });

    // Init
    window.addEventListener("load", async ()=>{
      const hash = location.hash.replace("#","");
      if (SHEETS[hash]) showSection(hash);
    });
  </script>
</body>
</html>
